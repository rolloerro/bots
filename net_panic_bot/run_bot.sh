#!/bin/bash
# =========================
# –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ NET_panic_bot
# =========================

BOT_NAME="bot.py"         # –≥–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª –±–æ—Ç–∞
VENV_PATH="./venv/bin/activate"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Å—Ç–∞—Ä—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –±–æ—Ç–∞
OLD_PIDS=$(pgrep -f "$BOT_NAME")
if [ -n "$OLD_PIDS" ]; then
    echo "‚ö†Ô∏è –ù–∞–π–¥–µ–Ω—ã —Å—Ç–∞—Ä—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –±–æ—Ç–∞, —É–±–∏–≤–∞–µ–º –∏—Ö: $OLD_PIDS"
    kill -9 $OLD_PIDS
fi

# –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
source $VENV_PATH

# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ –≤ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–º —Ü–∏–∫–ª–µ
echo "üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º $BOT_NAME..."
while true; do
    python3 $BOT_NAME
    EXIT_CODE=$?
    echo "‚ö†Ô∏è $BOT_NAME –∑–∞–≤–µ—Ä—à–∏–ª—Å—è —Å –∫–æ–¥–æ–º $EXIT_CODE. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥..."
    sleep 5
done
